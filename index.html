<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>購入履歴</title>

  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      padding:0;
      min-height:100vh;
      background:radial-gradient(circle at top left,#2a1c14,#0f0b09 70%);
      font-family:'Oswald',sans-serif;
      color:#e6d9c8;
    }

    .card{
      max-width:520px;
      margin:30px 0 30px 30px;
      background:linear-gradient(180deg,#1a120d,#120b08);
      border:1px solid #3a2a1d;
      border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.75), inset 0 0 30px rgba(255,200,120,.05);
      padding:26px;
    }

    h2{color:#f5deb3;letter-spacing:2px;margin-bottom:20px;}
    h3{margin-top:26px;color:#e0c58a;border-bottom:1px solid #3a2a1d;padding-bottom:6px;}
    label{display:block;margin-bottom:6px;color:#cdbba7;}

    input{
      width:100%;
      background:#0f0b09;
      color:#f0e6d8;
      border:1px solid #3a2a1d;
      border-radius:10px;
      padding:10px;
      font-size:15px;
      box-sizing:border-box;
    }

    .item-row{
      display:grid;
      grid-template-columns:140px 120px 120px;
      gap:8px;
      align-items:center;
      margin-top:10px;
      background:rgba(255,255,255,.02);
      border:1px solid #2e2118;
      border-radius:12px;
      padding:8px;
    }

    .item-name{color:#f5deb3;}

    .total-box{
      display:flex;
      justify-content:space-between;
      margin-top:24px;
      padding-top:12px;
      border-top:1px solid #3a2a1d;
    }

    #total{font-size:22px;color:#facc15;}

    button{
      width:100%;
      margin-top:22px;
      padding:14px;
      font-size:16px;
      font-weight:600;
      color:#2b1c0f;
      background:linear-gradient(180deg,#f5deb3,#caa45c);
      border:none;
      border-radius:14px;
      cursor:pointer;
    }

    /* 管理者モード */
    .item-price{cursor:not-allowed;}
    .admin-on .item-price{
      background:#1a140f;
      border-color:#caa45c;
      color:#ffd88a;
      cursor:text;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>tanu</h2>

  <label>管理者モード</label>
  <div style="display:flex;gap:8px;">
    <input type="password" id="adminPass" placeholder="パスコード">
    <button type="button" id="adminBtn">解除</button>
  </div>

  <form id="reserveForm">
    <label>名前と電話番号＜ゲーム内＞</label>
    <input type="text" id="name" placeholder="名前 / 電話番号" required>

    <h3>販売・売却</h3>
    <div id="items"></div>

    <div class="total-box">
      <span>合計金額</span>
      <strong id="total">¥0</strong>
    </div>

    <button type="submit">送信</button>
  </form>
</div>

<script>
const webhookURL = "YOUR_WEBHOOK_URL";
const ADMIN_PASSWORD = "85130";
let adminMode = false;

const fixedItems = [
  { name:"ガラス", price:3000 },
  { name:"プラスチック", price:10000 },
  { name:"銅", price:3000 },
  { name:"アルミニウム", price:10000 },
  { name:"鉄", price:10000 },
  { name:"剛鉄", price:10000 },
  { name:"スクラップ", price:10000 },
  { name:"ゴム", price:10000 },
  { name:"布", price:10000 },
  { name:"鉄粉", price:3000 },
  { name:"クリプト", price:3000 },
  { name:"買取・ガラス", price:1000 },
  { name:"買取・プラスチック", price:8000 },
  { name:"買取・銅", price:1000 },
  { name:"買取・アルミニウム", price:8000 },
  { name:"買取・鉄", price:8000 },
  { name:"買取・剛鉄", price:8000 },
  { name:"買取・スクラップ", price:8000 },
  { name:"買取・ゴム", price:8000 },
  { name:"買取・布", price:8000 },
  { name:"買取・鉄粉", price:1000 },
  { name:"買取・クリプト", price:1000 }
];

const itemsEl = document.getElementById("items");
const totalEl = document.getElementById("total");
const nameEl = document.getElementById("name");

fixedItems.forEach(item=>{
  const row=document.createElement("div");
  row.className="item-row";
  row.innerHTML=`
    <div class="item-name">${item.name}</div>
    <input type="number" class="item-price" value="${item.price}" readonly>
    <input type="number" class="item-qty" value="0" min="0">
  `;
  itemsEl.appendChild(row);
});

function calcTotal(){
  let total=0;
  document.querySelectorAll('.item-row').forEach(r=>{
    total += r.querySelector('.item-price').value * r.querySelector('.item-qty').value;
  });
  totalEl.textContent = `¥${total.toLocaleString()}`;
  return total;
}

document.addEventListener("input",e=>{
  if(e.target.classList.contains("item-price") || e.target.classList.contains("item-qty")){
    calcTotal();
  }
});

document.getElementById("adminBtn").addEventListener("click",()=>{
  const pass=document.getElementById("adminPass").value;
  if(!adminMode){
    if(pass!==ADMIN_PASSWORD){alert("パスコードが違います");return;}
    adminMode=true;
    document.body.classList.add("admin-on");
    document.querySelectorAll('.item-price').forEach(i=>i.removeAttribute("readonly"));
    alert("管理者モード ON");
  }else{
    adminMode=false;
    document.body.classList.remove("admin-on");
    document.querySelectorAll('.item-price').forEach(i=>i.setAttribute("readonly",true));
    document.getElementById("adminPass").value="";
    alert("管理者モード OFF");
  }
});

document.getElementById("reserveForm").addEventListener("submit",async e=>{
  e.preventDefault();

  const total=calcTotal();
  const fields=[
    { name:"名前 / 電話番号", value:nameEl.value }
  ];

  document.querySelectorAll('.item-row').forEach(r=>{
    const q=r.querySelector('.item-qty').value;
    if(q>0){
      fields.push({
        name:r.querySelector('.item-name').textContent,
        value:`${q} 個`,
        inline:true
      });
    }
  });

  fields.push({ name:"合計", value:`¥${total.toLocaleString()}` });

  await fetch(webhookURL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      embeds:[{
        title:"だぽん商店",
        color:0xC9A24D,
        fields,
        timestamp:new Date()
      }]
    })
  });

  alert("送信完了");
  e.target.reset();
  totalEl.textContent="¥0";
});
</script>

</body>
</html>
