<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>素材屋 取引伝票</title>

<style>
:root{
  --paper:#f6f1e7;
  --paper-dark:#e9e1d3;
  --ink:#2b2b2b;
  --sell:#4f8f4f;
  --buy:#b64a4a;
}

body{
  min-height:100vh;
  background:
    linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.4)),
    repeating-linear-gradient(
      90deg,
      #6b4f3f 0px,
      #6b4f3f 40px,
      #735744 40px,
      #735744 80px
    );
  font-family:"Noto Sans JP","Hiragino Maru Gothic ProN",system-ui,sans-serif;
  padding:24px;
  color:var(--ink);
}

body.buy-mode{
  background:
    linear-gradient(180deg,rgba(0,0,0,.3),rgba(0,0,0,.5)),
    repeating-linear-gradient(
      90deg,
      #5a3b3b 0px,
      #5a3b3b 40px,
      #633f3f 40px,
      #633f3f 80px
    );
}

/* ===== カード ===== */
.card{
  max-width:520px;
  margin:auto;
  padding:22px;
  border-radius:12px;
  background:
    repeating-linear-gradient(
      -45deg,
      #f6f1e7,
      #f6f1e7 6px,
      #f3ecdf 6px,
      #f3ecdf 12px
    );
  border:2px solid var(--paper-dark);
  box-shadow:0 8px 20px rgba(0,0,0,.4);
}

h2{
  text-align:center;
  letter-spacing:.15em;
  margin-bottom:4px;
}

.subtitle{
  text-align:center;
  font-size:12px;
  opacity:.7;
  margin-bottom:16px;
}

/* ===== 入力 ===== */
input{
  width:100%;
  box-sizing:border-box;
  padding:8px;
  height:36px;
  border-radius:6px;
  border:2px solid #c9bfae;
  background:#fffdf8;
  color:var(--ink);
  font-size:14px;
}

.form-group{
  display:grid;
  gap:10px;
  margin-bottom:14px;
}

/* ===== タブ ===== */
.tabs{
  display:flex;
  gap:6px;
  margin-bottom:14px;
}

.tab{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:2px solid #c9bfae;
  background:#fff;
  cursor:pointer;
  font-weight:600;
}

.tab.active{
  background:var(--paper-dark);
}

/* ===== アイテム一覧 ===== */
#items::before{
  content:"素材 / 単価 / 数量";
  display:grid;
  grid-template-columns:1fr 110px 70px;
  gap:10px;
  font-size:12px;
  opacity:.7;
  margin-bottom:6px;
}

.item-row{
  display:grid;
  grid-template-columns:1fr 110px 70px;
  gap:10px;
  margin-bottom:6px;
}

.item-price{
  text-align:right;
}

.item-qty{
  text-align:center;
}

/* ===== 合計 ===== */
.total-box{
  margin-top:16px;
  padding:14px;
  background:#fffdf8;
  border:2px dashed #c9bfae;
  border-radius:10px;
  display:flex;
  justify-content:center;
  gap:16px;
}

#total{
  font-size:22px;
  font-weight:700;
  color:var(--sell);
}

body.buy-mode #total{
  color:var(--buy);
}

/* ===== 送信 ===== */
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  border-radius:10px;
  border:none;
  background:linear-gradient(#fff,#e9e1d3);
  font-weight:700;
  cursor:pointer;
  box-shadow:0 4px 0 #c9bfae;
}

button:active{
  transform:translateY(2px);
  box-shadow:0 2px 0 #c9bfae;
}
</style>
</head>

<body>
<div class="card">
  <h2>だぽん商店＜素材屋＞</h2>
  <div class="subtitle">― 取引伝票 ―</div>

  <div class="form-group">
    <input id="shop" placeholder="電話番号＜ゲーム内＞">
    <input id="name" placeholder="お客様名">
  </div>

  <div class="tabs">
    <button class="tab active" data-mode="sell">販売</button>
    <button class="tab" data-mode="buy">買取</button>
  </div>

  <div id="items"></div>

  <div class="total-box">
    <span id="totalLabel">支払額</span>
    <strong id="total">¥0</strong>
  </div>

  <button id="sendBtn">伝票を送信</button>
</div>

<script>
const webhookURL = "https://discord.com/api/webhooks/1462395204198727875/p7qXdYd-sPkx8ymUqa4HzhVP8WSmb5-DgSr8inQABH7CfubgKgfyPGOcaI4XTtld5kdp";

  
let mode = "sell";

const data = {
  sell: [
  { name:"プラスチック", price:7000 },
  { name:"アルミニウム", price:7000 },
  { name:"鉄", price:7000 },
  { name:"剛鉄", price:7000 },
  { name:"スクラップ", price:7000 },
  { name:"ゴム", price:7000 },
  { name:"布", price:7000 },
  ],
  buy: [
  { name:"プラスチック", price:5000 },
  { name:"アルミニウム", price:5000 },
  { name:"鉄", price:5000 },
  { name:"剛鉄", price:5000 },
  { name:"スクラップ", price:5000 },
  { name:"ゴム", price:5000 },
  { name:"布", price:5000 },
  { name:"‐－－－－－－－－－－－", price:0 },
  { name:"エイ", price:1250000 },
  { name:"サメ", price:1100000 },
  { name:"‐－－－－－－－－－－－", price:0 },
  ]
};

const itemsEl = document.getElementById("items");
const totalEl = document.getElementById("total");
const totalLabel = document.getElementById("totalLabel");
const nameEl = document.getElementById("name");
const shopEl = document.getElementById("shop");

function render(){
  itemsEl.innerHTML = "";
  data[mode].forEach(i=>{
    itemsEl.innerHTML += `
      <div class="item-row">
        <div>${i.name}</div>
        <input class="item-price" value="${i.price}" readonly>
        <input class="item-qty" type="number" value="0" min="0">
      </div>
    `;
  });
  totalEl.textContent = "¥0";
  totalLabel.textContent = mode==="sell" ? "支払額" : "受取額";
  document.body.classList.toggle("buy-mode", mode==="buy");
}
render();

function calc(){
  let total = 0;
  document.querySelectorAll(".item-row").forEach(r=>{
    total += Number(r.children[1].value) * Number(r.children[2].value);
  });
  totalEl.textContent = `¥${total.toLocaleString()}`;
}

document.addEventListener("input", calc);

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick = ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    mode = t.dataset.mode;
    render();
  };
});

sendBtn.onclick = async ()=>{
  if(!nameEl.value) return alert("名前を入力してください");

  const fields = [
    { name:"名前", value:nameEl.value, inline:true }
  ];

  if(shopEl.value){
    fields.push({ name:"担当", value:shopEl.value, inline:true });
  }

  document.querySelectorAll(".item-row").forEach(r=>{
    const qty = Number(r.children[2].value);
    if(qty > 0){
      fields.push({
        name: r.children[0].textContent,
        value: `${qty} 個`,
        inline: true
      });
    }
  });

  fields.push({
    name: mode==="sell" ? "支払額" : "受取額",
    value: totalEl.textContent
  });

  await fetch(webhookURL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      embeds:[{
        title:`【${mode==="sell"?"販売":"買取"}】だぽん商店＜素材屋＞`,
        color: mode==="sell"?0x4F8F4F:0xB64A4A,
        fields,
        timestamp:new Date().toISOString()
      }]
    })
  });

  alert("伝票を送信しました");
  render();
  nameEl.value="";
};
</script>
</body>
</html>
